<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Overlay Position - Visual Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #f39c12, #e74c3c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      text-align: center;
      color: #8b8b8b;
      margin-bottom: 30px;
    }
    
    .description {
      max-width: 800px;
      margin: 0 auto 30px;
      padding: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      border-left: 4px solid #f39c12;
    }
    
    .description h3 {
      color: #f39c12;
      margin-bottom: 10px;
    }
    
    .description ul {
      margin-left: 20px;
      color: #ccc;
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .test-card {
      background: rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .test-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    
    .test-card h3 {
      margin-bottom: 15px;
      color: #fff;
    }
    
    .thumbnail-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 8px;
      overflow: hidden;
      background: #000;
      margin-bottom: 15px;
    }
    
    .thumbnail-container canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* ë¶„ì„ ê²°ê³¼ í‘œì‹œ ì  */
    .analysis-dot {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #e74c3c;
      border: 3px solid #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 15px rgba(231, 76, 60, 0.8);
      z-index: 10;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
    }
    
    /* ê·¸ë¦¬ë“œ ì˜¤ë²„ë ˆì´ */
    .grid-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.3;
    }
    
    .result-info {
      background: rgba(0,0,0,0.3);
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .result-info .label {
      color: #8b8b8b;
    }
    
    .result-info .value {
      color: #3498db;
      font-weight: bold;
    }
    
    .result-info .position {
      color: #2ecc71;
      font-size: 16px;
    }
    
    .legend {
      max-width: 800px;
      margin: 40px auto 0;
      display: flex;
      gap: 30px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .legend-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid #fff;
    }
    
    .legend-dot.red { background: #e74c3c; }
    .legend-dot.green { background: #2ecc71; }
  </style>
</head>
<body>
  <h1>ğŸ”¬ Smart Overlay Position Visualizer</h1>
  <p class="subtitle">canvasAnalyzer ì•Œê³ ë¦¬ì¦˜ ì‹œê°ì  ê²€ì¦ ë„êµ¬</p>
  
  <div class="description">
    <h3>ğŸ“‹ í…ŒìŠ¤íŠ¸ ë°©ë²•</h3>
    <ul>
      <li><strong>ë¹¨ê°„ ì </strong> = ì•Œê³ ë¦¬ì¦˜ì´ ì°¾ì€ "ê°€ì¥ ë¹ˆ ê³µê°„" (ë³µì¡ë„ ìµœì €)</li>
      <li>ê° í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ì—ì„œ ë¹¨ê°„ ì ì´ <strong>ë°‹ë°‹í•œ ì˜ì—­</strong>ì— ìˆìœ¼ë©´ ì„±ê³µ</li>
      <li>4x4 ê·¸ë¦¬ë“œë¡œ ë¶„í•  â†’ 16ì¹¸ ì¤‘ ë³µì¡ë„ê°€ ê°€ì¥ ë‚®ì€ ì…€ ì„ íƒ</li>
    </ul>
  </div>
  
  <div class="test-grid" id="testGrid">
    <!-- í…ŒìŠ¤íŠ¸ ì¹´ë“œë“¤ì´ JavaScriptë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
  </div>
  
  <div class="legend">
    <div class="legend-item">
      <div class="legend-dot red"></div>
      <span>ë¶„ì„ëœ ìµœì  ìœ„ì¹˜ (ë¹ˆ ê³µê°„)</span>
    </div>
  </div>

  <script>
    // ============================================
    // canvasAnalyzer ì•Œê³ ë¦¬ì¦˜ (ë¸Œë¼ìš°ì €ìš© ë³µì‚¬ë³¸)
    // ============================================
    
    /**
     * ITU-R BT.601 í‘œì¤€ ë°ê¸° ê³„ì‚°
     */
    function calculateBrightness(r, g, b) {
      return 0.299 * r + 0.587 * g + 0.114 * b;
    }
    
    /**
     * ë°ê¸° ê°’ ë°°ì—´ì˜ ë¶„ì‚°(ë³µì¡ë„) ê³„ì‚°
     */
    function calculateComplexity(values) {
      if (values.length === 0) return 0;
      const mean = values.reduce((a, b) => a + b, 0) / values.length;
      const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
      return variance;
    }
    
    /**
     * ImageDataë¥¼ 4x4 ê·¸ë¦¬ë“œë¡œ ë¶„í• í•˜ê³  ê° ì…€ì˜ ë³µì¡ë„ ê³„ì‚°
     */
    function analyzeGrid(imageData, gridSize = 4) {
      const { width, height, data } = imageData;
      const cellWidth = Math.floor(width / gridSize);
      const cellHeight = Math.floor(height / gridSize);
      const grid = [];
      
      for (let gy = 0; gy < gridSize; gy++) {
        for (let gx = 0; gx < gridSize; gx++) {
          const startX = gx * cellWidth;
          const startY = gy * cellHeight;
          const brightnessValues = [];
          
          for (let y = startY; y < startY + cellHeight; y++) {
            for (let x = startX; x < startX + cellWidth; x++) {
              const idx = (y * width + x) * 4;
              const brightness = calculateBrightness(data[idx], data[idx + 1], data[idx + 2]);
              brightnessValues.push(brightness);
            }
          }
          
          grid.push({
            x: gx,
            y: gy,
            complexity: calculateComplexity(brightnessValues)
          });
        }
      }
      
      return grid;
    }
    
    /**
     * ê°€ì¥ ë³µì¡ë„ê°€ ë‚®ì€ ì…€ì˜ ì¤‘ì•™ ìœ„ì¹˜ ë°˜í™˜
     */
    function findBestPosition(grid, gridSize = 4) {
      const sorted = [...grid].sort((a, b) => a.complexity - b.complexity);
      const bestCell = sorted[0];
      
      const cellWidthPercent = 100 / gridSize;
      const cellHeightPercent = 100 / gridSize;
      
      const x = bestCell.x * cellWidthPercent + cellWidthPercent / 2;
      const y = bestCell.y * cellHeightPercent + cellHeightPercent / 2;
      
      return { x, y, cell: bestCell };
    }
    
    // ============================================
    // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„±ê¸°
    // ============================================
    
    const testCases = [
      {
        name: "1. ì™¼ìª½ ë‹¨ìƒ‰, ì˜¤ë¥¸ìª½ ë³µì¡",
        description: "ì™¼ìª½ ì ˆë°˜ì€ ê²€ì •ìƒ‰, ì˜¤ë¥¸ìª½ì€ ìƒ‰ìƒ ë…¸ì´ì¦ˆ",
        expected: "ì™¼ìª½ ì˜ì—­ (x < 50%)",
        generator: (ctx, w, h) => {
          // ì™¼ìª½ = ê²€ì • (ë‹¨ìˆœ)
          ctx.fillStyle = '#000';
          ctx.fillRect(0, 0, w/2, h);
          
          // ì˜¤ë¥¸ìª½ = ë…¸ì´ì¦ˆ (ë³µì¡)
          for (let x = w/2; x < w; x += 4) {
            for (let y = 0; y < h; y += 4) {
              ctx.fillStyle = `hsl(${Math.random()*360}, 70%, 50%)`;
              ctx.fillRect(x, y, 4, 4);
            }
          }
        }
      },
      {
        name: "2. ìƒë‹¨ ë³µì¡, í•˜ë‹¨ ë‹¨ìƒ‰",
        description: "ìƒë‹¨ì€ ê·¸ë¼ë””ì–¸íŠ¸, í•˜ë‹¨ì€ í°ìƒ‰",
        expected: "í•˜ë‹¨ ì˜ì—­ (y > 50%)",
        generator: (ctx, w, h) => {
          // ìƒë‹¨ = ê·¸ë¼ë””ì–¸íŠ¸ + ë…¸ì´ì¦ˆ
          const gradient = ctx.createLinearGradient(0, 0, w, 0);
          gradient.addColorStop(0, '#e74c3c');
          gradient.addColorStop(0.5, '#3498db');
          gradient.addColorStop(1, '#2ecc71');
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, w, h/2);
          
          // ìƒë‹¨ì— ë…¸ì´ì¦ˆ ì¶”ê°€
          for (let i = 0; i < 100; i++) {
            ctx.fillStyle = `rgba(255,255,255,0.3)`;
            ctx.fillRect(Math.random()*w, Math.random()*h/2, 5, 5);
          }
          
          // í•˜ë‹¨ = í°ìƒ‰ (ë‹¨ìˆœ)
          ctx.fillStyle = '#fff';
          ctx.fillRect(0, h/2, w, h/2);
        }
      },
      {
        name: "3. ì¢Œìƒë‹¨ë§Œ ë‹¨ìƒ‰",
        description: "ì¢Œìƒë‹¨ 1/4ë§Œ íŒŒë€ìƒ‰, ë‚˜ë¨¸ì§€ëŠ” ë…¸ì´ì¦ˆ",
        expected: "ì¢Œìƒë‹¨ (x=12.5%, y=12.5%)",
        generator: (ctx, w, h) => {
          // ì „ì²´ = ë…¸ì´ì¦ˆ
          for (let x = 0; x < w; x += 3) {
            for (let y = 0; y < h; y += 3) {
              ctx.fillStyle = `hsl(${Math.random()*360}, 60%, 40%)`;
              ctx.fillRect(x, y, 3, 3);
            }
          }
          
          // ì¢Œìƒë‹¨ = ë‹¨ìƒ‰ íŒŒë‘
          ctx.fillStyle = '#3498db';
          ctx.fillRect(0, 0, w/4, h/4);
        }
      },
      {
        name: "4. ì „ì²´ ë‹¨ìƒ‰",
        description: "ì „ì²´ê°€ ë™ì¼í•œ íšŒìƒ‰",
        expected: "ì²« ë²ˆì§¸ ì…€ (x=12.5%, y=12.5%)",
        generator: (ctx, w, h) => {
          ctx.fillStyle = '#666';
          ctx.fillRect(0, 0, w, h);
        }
      },
      {
        name: "5. ìš°í•˜ë‹¨ë§Œ ë‹¨ìƒ‰",
        description: "ìš°í•˜ë‹¨ 1/4ë§Œ ë…¹ìƒ‰, ë‚˜ë¨¸ì§€ëŠ” ë³µì¡",
        expected: "ìš°í•˜ë‹¨ (x=87.5%, y=87.5%)",
        generator: (ctx, w, h) => {
          // ì „ì²´ = ë…¸ì´ì¦ˆ
          for (let x = 0; x < w; x += 4) {
            for (let y = 0; y < h; y += 4) {
              ctx.fillStyle = `rgb(${Math.random()*255},${Math.random()*255},${Math.random()*255})`;
              ctx.fillRect(x, y, 4, 4);
            }
          }
          
          // ìš°í•˜ë‹¨ = ë‹¨ìƒ‰ ë…¹ìƒ‰
          ctx.fillStyle = '#2ecc71';
          ctx.fillRect(w*3/4, h*3/4, w/4, h/4);
        }
      },
      {
        name: "6. ì¤‘ì•™ë§Œ ë‹¨ìƒ‰",
        description: "ì¤‘ì•™ì— ì›í˜• ë‹¨ìƒ‰ ì˜ì—­",
        expected: "ì¤‘ì•™ ê·¼ì²˜ (xâ‰ˆ50%, yâ‰ˆ50%)",
        generator: (ctx, w, h) => {
          // ì „ì²´ = ë…¸ì´ì¦ˆ
          for (let x = 0; x < w; x += 3) {
            for (let y = 0; y < h; y += 3) {
              ctx.fillStyle = `hsl(${y/h*360}, 70%, 50%)`;
              ctx.fillRect(x, y, 3, 3);
            }
          }
          
          // ì¤‘ì•™ = ë‹¨ìƒ‰ ì›
          ctx.fillStyle = '#f39c12';
          ctx.beginPath();
          ctx.arc(w/2, h/2, Math.min(w, h)/4, 0, Math.PI*2);
          ctx.fill();
        }
      }
    ];
    
    // ============================================
    // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    // ============================================
    
    function runTests() {
      const grid = document.getElementById('testGrid');
      
      testCases.forEach((testCase, index) => {
        const card = document.createElement('div');
        card.className = 'test-card';
        
        // ì¸ë„¤ì¼ ì»¨í…Œì´ë„ˆ
        const container = document.createElement('div');
        container.className = 'thumbnail-container';
        
        // Canvas ìƒì„± ë° í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
        const canvas = document.createElement('canvas');
        canvas.width = 320;
        canvas.height = 180;
        const ctx = canvas.getContext('2d');
        
        // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìƒì„±
        testCase.generator(ctx, canvas.width, canvas.height);
        
        // ë¶„ì„ ì‹¤í–‰
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const analyzedGrid = analyzeGrid(imageData, 4);
        const result = findBestPosition(analyzedGrid, 4);
        
        container.appendChild(canvas);
        
        // 4x4 ê·¸ë¦¬ë“œ ì˜¤ë²„ë ˆì´ (ì„ íƒì )
        const gridOverlay = document.createElement('canvas');
        gridOverlay.className = 'grid-overlay';
        gridOverlay.width = 320;
        gridOverlay.height = 180;
        const gridCtx = gridOverlay.getContext('2d');
        gridCtx.strokeStyle = 'rgba(255,255,255,0.5)';
        gridCtx.lineWidth = 1;
        for (let i = 1; i < 4; i++) {
          gridCtx.beginPath();
          gridCtx.moveTo(i * 80, 0);
          gridCtx.lineTo(i * 80, 180);
          gridCtx.stroke();
          gridCtx.beginPath();
          gridCtx.moveTo(0, i * 45);
          gridCtx.lineTo(320, i * 45);
          gridCtx.stroke();
        }
        container.appendChild(gridOverlay);
        
        // ë¶„ì„ ê²°ê³¼ ì  í‘œì‹œ
        const dot = document.createElement('div');
        dot.className = 'analysis-dot';
        dot.style.left = `${result.x}%`;
        dot.style.top = `${result.y}%`;
        container.appendChild(dot);
        
        // ê²°ê³¼ ì •ë³´
        const resultInfo = document.createElement('div');
        resultInfo.className = 'result-info';
        resultInfo.innerHTML = `
          <div><span class="label">ë¶„ì„ ìœ„ì¹˜:</span> <span class="position">x=${result.x.toFixed(1)}%, y=${result.y.toFixed(1)}%</span></div>
          <div><span class="label">ì„ íƒëœ ì…€:</span> <span class="value">(${result.cell.x}, ${result.cell.y})</span></div>
          <div><span class="label">ë³µì¡ë„:</span> <span class="value">${result.cell.complexity.toFixed(2)}</span></div>
          <div style="margin-top:8px;color:#888;font-size:12px;">ì˜ˆìƒ: ${testCase.expected}</div>
        `;
        
        card.innerHTML = `<h3>${testCase.name}</h3><p style="color:#888;margin-bottom:15px;font-size:13px;">${testCase.description}</p>`;
        card.appendChild(container);
        card.appendChild(resultInfo);
        
        grid.appendChild(card);
      });
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    window.onload = runTests;
  </script>
</body>
</html>
